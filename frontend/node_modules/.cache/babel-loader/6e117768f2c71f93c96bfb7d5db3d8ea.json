{"ast":null,"code":"import _regeneratorRuntime from\"/Users/jielianglin/Desktop/m-v2-frontend/frontend/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/jielianglin/Desktop/m-v2-frontend/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"/Users/jielianglin/Desktop/m-v2-frontend/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/jielianglin/Desktop/m-v2-frontend/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from'react';import axios from\"axios\";import FileInput from'../FileInput';import Tags from'./Tags';import Caption from'./Caption';import Sketch from'react-p5';import ColorSelector from'./ColorSelector';import EraserIcon from'./eraser/EraserIcon.png';import CheckMark from'./checkmark/CheckMark.png';import{Typography,Chip,Avatar}from\"@material-ui/core\";import Button from\"@material-ui/core/Button\";import VisibilitySharpIcon from'@material-ui/icons/VisibilitySharp';import VisibilityOffIcon from'@material-ui/icons/VisibilityOff';import{ThemeProvider}from\"@material-ui/styles\";import CircularProgress from\"@material-ui/core/CircularProgress\";import{createTheme}from\"@material-ui/core/styles\";import MatchBar from\"../../explore/Matchbar\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var checkButton;var cnv;var smoothValue=0.05;var init;var x=0;var y=0;var path=[];var currentPath=[];var img;var pg;var clearButton;var imgWidth;var imgHeight;var theme=createTheme({palette:{primary:{main:\"#B272CE\"}}});export default function P5Lasso(){var _React$useState=React.useState([\"#B272CE\"]),_React$useState2=_slicedToArray(_React$useState,2),color=_React$useState2[0],setColor=_React$useState2[1];var _React$useState3=React.useState(null),_React$useState4=_slicedToArray(_React$useState3,2),canvasImage=_React$useState4[0],setCanvasImage=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),post=_React$useState6[0],setPost=_React$useState6[1];var _React$useState7=React.useState([]),_React$useState8=_slicedToArray(_React$useState7,2),tags=_React$useState8[0],setTags=_React$useState8[1];var _React$useState9=React.useState(null),_React$useState10=_slicedToArray(_React$useState9,2),src=_React$useState10[0],setSrc=_React$useState10[1];var _React$useState11=React.useState(null),_React$useState12=_slicedToArray(_React$useState11,2),caption=_React$useState12[0],setCaption=_React$useState12[1];var _React$useState13=React.useState(null),_React$useState14=_slicedToArray(_React$useState13,2),returnCaption=_React$useState14[0],setReturnCaption=_React$useState14[1];var _React$useState15=React.useState([]),_React$useState16=_slicedToArray(_React$useState15,2),returnTags=_React$useState16[0],setReturnTags=_React$useState16[1];var _React$useState17=React.useState([]),_React$useState18=_slicedToArray(_React$useState17,2),returnAITags=_React$useState18[0],setReturnAITags=_React$useState18[1];var _React$useState19=React.useState([]),_React$useState20=_slicedToArray(_React$useState19,2),returnShape=_React$useState20[0],setReturnShape=_React$useState20[1];var _React$useState21=React.useState(false),_React$useState22=_slicedToArray(_React$useState21,2),shapeVisibility=_React$useState22[0],setShapeVisibility=_React$useState22[1];var _React$useState23=React.useState(false),_React$useState24=_slicedToArray(_React$useState23,2),progress=_React$useState24[0],setProgress=_React$useState24[1];var enteredCaption=function enteredCaption(caption){setCaption(caption);};var selectedTags=function selectedTags(tags){setTags(tags);};// const selectedImage = (img) => {\n//   setImage(img);\n//   setCanvasImage(img);\n//   console.log(\"setImage\");\n// };\nvar resetCanvas=function resetCanvas(){setCanvasImage(!canvasImage);};function setup(p5,canvasParentRef){cnv=p5.createCanvas(600,600).parent(canvasParentRef);pg=p5.createGraphics(600,600);p5.background('black');img=p5.loadImage(canvasImage,function(img){p5.image(img,0,0);console.log(\"canvasImage\");});checkButton=p5.createImg(\"\".concat(CheckMark)).style('margin: 10px; width: 50px; height: 50px');checkButton.position(100,200);checkButton.mousePressed(setFiles);clearButton=p5.createImg(\"\".concat(EraserIcon)).style('margin: 10px; width: 50px; height: 50px');clearButton.position(100,300);clearButton.mousePressed(resetSketch);}function draw(p5){x=p5.lerp(x,p5.mouseX,smoothValue);y=p5.lerp(y,p5.mouseY,smoothValue);imgWidth=img.width;imgHeight=img.height;if(imgWidth>0&&imgHeight>0){p5.resizeCanvas(imgWidth,imgHeight);if(imgWidth>700){p5.resizeCanvas(700,700);}}p5.image(img,0,0);if(p5.mouseIsPressed){pg.fill(color);pg.stroke(color);pg.strokeWeight(1);pg.ellipse(x,y,15,15);currentPath.push([x,y]);init=currentPath[0];}p5.image(pg,0,0,imgWidth,imgHeight);}function mouseReleased(p5){if(canvasImage){var _pg;pg.strokeWeight(15);(_pg=pg).line.apply(_pg,[x,y].concat(_toConsumableArray(init)));currentPath=[];path.push(currentPath);}}function resetSketch(p5){pg.clear();}//preparing files for post\nfunction setFiles(p5){var image=cnv.elt.toDataURL();var shape=pg.elt.toDataURL();return{image:image,shape:shape};}var APIurl=\"http://localhost:8000/images\";// main post function\nfunction postData(_x){return _postData.apply(this,arguments);}function _postData(){_postData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(p5){var _setFiles,image,shape,formData,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_setFiles=setFiles(p5),image=_setFiles.image,shape=_setFiles.shape;formData=new FormData();console.log(tags.join(\",\"));formData.append(\"tags\",tags.join(\",\"));formData.append(\"caption\",caption);formData.append(\"files\",[image,shape]);response={};_context.prev=7;_context.next=10;return axios.post(APIurl,formData);case 10:response=_context.sent;_context.next=17;break;case 13:_context.prev=13;_context.t0=_context[\"catch\"](7);console.error(_context.t0);return _context.abrupt(\"return\");case 17:setSrc(\"http://localhost:8000/images/\".concat(response.data.id,\".jpeg\"));console.log(response.data.caption);setReturnCaption(response.data.caption);console.log(response.data.tags);setReturnTags(response.data.tags);console.log(response.data.ai_tags);setReturnAITags(response.data.ai_tags||[]);setReturnShape(\"http://localhost:8000/images/\".concat(response.data.shape,\".png\"));setPost(true);setProgress(false);case 27:case\"end\":return _context.stop();}}},_callee,null,[[7,13]]);}));return _postData.apply(this,arguments);}var showShape=function showShape(){setShapeVisibility(!shapeVisibility);};if(canvasImage){return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"div\",{style:{backgroundColor:\"#FFFFFF\",borderRadius:\"3px\",boxShadow:\"3px 3px 3px #b4beb7\",padding:\"50px\",maxWidth:\"800px\",height:\"auto\"},children:[/*#__PURE__*/_jsx(Caption,{enteredCaption:enteredCaption}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Sketch,{setup:setup,draw:draw,mouseReleased:mouseReleased,resetSketch:resetSketch,setFiles:setFiles})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Tags,{selectedTags:selectedTags})]}),/*#__PURE__*/_jsx(ColorSelector,{selectColor:function selectColor(color){return setColor(color);}}),/*#__PURE__*/_jsxs(\"div\",{className:\"save-data\",children:[/*#__PURE__*/_jsxs(Button,{disabled:!canvasImage||!caption||tags.length===0,className:\"save-button\",palette:\"primary\",onClick:postData,children:[\" \",\"Save\",\" \"]}),/*#__PURE__*/_jsx(ThemeProvider,{theme:theme,children:progress&&/*#__PURE__*/_jsx(CircularProgress,{})})]}),post?/*#__PURE__*/_jsxs(\"div\",{className:\"returnForm\",style:{backgroundColor:\"#FFFFFF\",borderRadius:\"3px\",boxShadow:\"3px 3px 3px #b4beb7\",padding:\"50px\",maxWidth:\"800px\",height:\"auto\"},children:[/*#__PURE__*/_jsx(\"img\",{style:{display:\"block\",margin:\"0 auto\",height:\"50%\",borderRadius:\"5px\",zIndex:1},className:\"returned-image\",src:src,alt:\"\"}),shapeVisibility&&/*#__PURE__*/_jsx(\"img\",{style:{display:\"block\",margin:\"0 auto\",height:\"50%\",borderRadius:\"5px\",zIndex:2},className:\"returned-shape\",src:returnShape,alt:\"\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Button,{onClick:showShape,children:shapeVisibility?/*#__PURE__*/_jsx(VisibilityOffIcon,{fontsize:\"medium\"}):/*#__PURE__*/_jsx(VisibilitySharpIcon,{fontsize:\"medium\"})}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(ThemeProvider,{theme:theme,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",color:\"primary\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"returned-caption\",children:[/*#__PURE__*/_jsx(\"i\",{children:\"\\\"\"}),/*#__PURE__*/_jsxs(\"i\",{children:[\" \",/*#__PURE__*/_jsx(\"span\",{children:returnCaption}),\" \"]}),/*#__PURE__*/_jsx(\"i\",{children:\"\\\"\"})]})}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"span\",{className:\"tags-return\",children:[/*#__PURE__*/_jsx(Typography,{color:\"primary\",children:\" Your Tags: \"}),returnTags.map(function(item){return/*#__PURE__*/_jsx(Chip,{className:\"chip1\",style:{color:\"#B272CE\",backgroundColor:\"#FFFFFF\"},avatar:/*#__PURE__*/_jsx(Avatar,{style:{color:\"#B272CE\"},children:/*#__PURE__*/_jsx(\"div\",{style:{color:\"#FFFFFF\"},children:\"#\"})}),label:item.tag,variant:\"outlined\"},item.id);})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"span\",{className:\"ai_tags_return\",children:[/*#__PURE__*/_jsx(Typography,{color:\"secondary\",children:\" Tags from ImageNet AI: \"}),returnAITags.length===0&&/*#__PURE__*/_jsx(Typography,{variant:\"h12\",color:\"#000000\",children:/*#__PURE__*/_jsx(\"i\",{children:\"[couldn't identify any tags] \"})}),returnAITags.map(function(item){return/*#__PURE__*/_jsx(Chip,{className:\"chip2\",style:{color:\"#000000\",backgroundColor:\"#FFFFFF\"},avatar:/*#__PURE__*/_jsx(Avatar,{style:{background:\"#B5BCB4\"},children:/*#__PURE__*/_jsx(\"div\",{style:{color:\"#FFFFFF\"},children:\"#\"})}),label:item.tag},item.id);}),/*#__PURE__*/_jsx(\"div\",{children:returnAITags.map(function(aiitem){return/*#__PURE__*/_jsx(MatchBar,{match:parseFloat(aiitem.confidence),aitag:aiitem.tag});})})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Button,{onClick:resetCanvas,children:\"Back to Well-Being upload\"}),/*#__PURE__*/_jsx(\"br\",{})]})]}):null]});}else{return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(FileInput,{selectImage:setCanvasImage// selectedImage={selectedImage}\n})});}}","map":{"version":3,"sources":["/Users/jielianglin/Desktop/m-v2-frontend/frontend/src/components/upload/annotation/P5Lasso.js"],"names":["React","axios","FileInput","Tags","Caption","Sketch","ColorSelector","EraserIcon","CheckMark","Typography","Chip","Avatar","Button","VisibilitySharpIcon","VisibilityOffIcon","ThemeProvider","CircularProgress","createTheme","MatchBar","checkButton","cnv","smoothValue","init","x","y","path","currentPath","img","pg","clearButton","imgWidth","imgHeight","theme","palette","primary","main","P5Lasso","useState","color","setColor","canvasImage","setCanvasImage","post","setPost","tags","setTags","src","setSrc","caption","setCaption","returnCaption","setReturnCaption","returnTags","setReturnTags","returnAITags","setReturnAITags","returnShape","setReturnShape","shapeVisibility","setShapeVisibility","progress","setProgress","enteredCaption","selectedTags","resetCanvas","setup","p5","canvasParentRef","createCanvas","parent","createGraphics","background","loadImage","image","console","log","createImg","style","position","mousePressed","setFiles","resetSketch","draw","lerp","mouseX","mouseY","width","height","resizeCanvas","mouseIsPressed","fill","stroke","strokeWeight","ellipse","push","mouseReleased","line","clear","elt","toDataURL","shape","APIurl","postData","formData","FormData","join","append","response","error","data","id","ai_tags","showShape","backgroundColor","borderRadius","boxShadow","padding","maxWidth","length","display","margin","zIndex","map","item","tag","aiitem","parseFloat","confidence"],"mappings":"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","sourcesContent":["import React from 'react';\nimport axios from \"axios\";\n\nimport FileInput from '../FileInput';\nimport Tags from './Tags';\nimport Caption from './Caption';\n\nimport Sketch from 'react-p5';\nimport ColorSelector from './ColorSelector';\n\nimport EraserIcon from './eraser/EraserIcon.png';\nimport CheckMark from './checkmark/CheckMark.png';\n\nimport { Typography, Chip, Avatar } from \"@material-ui/core\";\nimport Button from \"@material-ui/core/Button\";\nimport VisibilitySharpIcon from '@material-ui/icons/VisibilitySharp';\nimport VisibilityOffIcon from '@material-ui/icons/VisibilityOff';\n\nimport { ThemeProvider } from \"@material-ui/styles\";\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\nimport { createTheme } from \"@material-ui/core/styles\";\n\nimport MatchBar from \"../../explore/Matchbar\";\n\nvar checkButton;\nvar cnv;\nvar smoothValue = 0.05;\nvar init;\nvar x = 0;\nvar y = 0;\nvar path = [];\nvar currentPath = [];\nvar img;\nvar pg;\nvar clearButton;\nvar imgWidth;\nvar imgHeight;\n\nconst theme = createTheme({\n  palette: {\n    primary: {\n      main: \"#B272CE\",\n    },\n  },\n});\n\nexport default function P5Lasso() {\n  const [color, setColor] = React.useState([\"#B272CE\"]);\n  const [canvasImage, setCanvasImage] = React.useState(null);\n\n  const [post, setPost] = React.useState(false);\n  const [tags, setTags] = React.useState([]);\n  const [src, setSrc] = React.useState(null);\n  const [caption, setCaption] = React.useState(null);\n  const [returnCaption, setReturnCaption] = React.useState(null);\n  const [returnTags, setReturnTags] = React.useState([])\n  const [returnAITags, setReturnAITags] = React.useState([]);\n  const [returnShape, setReturnShape] = React.useState([]);\n  const [shapeVisibility, setShapeVisibility] = React.useState(false);\n  const [progress, setProgress] = React.useState(false);\n\n  const enteredCaption = (caption) => {\n    setCaption(caption);\n  };\n  const selectedTags = (tags) => {\n    setTags(tags);\n  };\n\n  // const selectedImage = (img) => {\n  //   setImage(img);\n  //   setCanvasImage(img);\n  //   console.log(\"setImage\");\n  // };\n\n  const resetCanvas = () => {\n    setCanvasImage(!canvasImage);\n  }\n\n  function setup(p5, canvasParentRef) {\n    cnv = p5.createCanvas(600, 600).parent(canvasParentRef);\n    pg = p5.createGraphics(600, 600);\n    p5.background('black');\n    img = p5.loadImage(canvasImage, img => {\n      p5.image(img, 0, 0);\n      console.log(\"canvasImage\");\n    });\n\n    checkButton = p5.createImg(`${CheckMark}`).style(\n      'margin: 10px; width: 50px; height: 50px'\n    )\n\n    checkButton.position(100, 200);\n    checkButton.mousePressed(setFiles);\n\n    clearButton = p5.createImg(`${EraserIcon}`).style(\n      'margin: 10px; width: 50px; height: 50px'\n    )\n    clearButton.position(100, 300);\n    clearButton.mousePressed(resetSketch);\n  }\n\n  function draw(p5) {\n    x = p5.lerp(x, p5.mouseX, smoothValue);\n    y = p5.lerp(y, p5.mouseY, smoothValue);\n\n    imgWidth = img.width;\n    imgHeight = img.height;\n\n    if (imgWidth > 0 && imgHeight > 0) {\n      p5.resizeCanvas(imgWidth, imgHeight);\n      if (imgWidth > 700) {\n        p5.resizeCanvas(700, 700);\n      }\n    }\n\n    p5.image(img, 0, 0);\n\n    if (p5.mouseIsPressed) {\n      pg.fill(color);\n      pg.stroke(color);\n      pg.strokeWeight(1);\n      pg.ellipse(x, y, 15, 15);\n      currentPath.push([x, y]);\n      init = currentPath[0];\n    }\n    p5.image(pg, 0, 0, imgWidth, imgHeight);\n  }\n\n  function mouseReleased(p5) {\n    if (canvasImage) {\n      pg.strokeWeight(15);\n      pg.line(x, y, ...init);\n      currentPath = [];\n      path.push(currentPath);\n    }\n  }\n\n  function resetSketch(p5) {\n    pg.clear();\n  }\n\n  //preparing files for post\n  function setFiles(p5) {\n    let image = cnv.elt.toDataURL();\n    let shape = pg.elt.toDataURL();\n    return { image, shape };\n  }\n\n  let APIurl = \"http://localhost:8000/images\";\n\n  // main post function\n  async function postData(p5) {\n    let { image, shape } = setFiles(p5);\n\n    let formData = new FormData();\n    console.log(tags.join(\",\"));\n    formData.append(\"tags\", tags.join(\",\"));\n    formData.append(\"caption\", caption);\n    formData.append(\"files\", [image, shape]);\n\n    let response = {};\n    try {\n      response = await axios.post(APIurl, formData);\n    } catch (e) {\n      console.error(e);\n      return;\n    }\n\n    setSrc(`http://localhost:8000/images/${response.data.id}.jpeg`);\n    console.log(response.data.caption);\n    setReturnCaption(response.data.caption);\n    console.log(response.data.tags);\n    setReturnTags(response.data.tags);\n    console.log(response.data.ai_tags);\n    setReturnAITags(response.data.ai_tags || []);\n    setReturnShape(`http://localhost:8000/images/${response.data.shape}.png`);\n    setPost(true);\n    setProgress(false);\n  }\n\n  const showShape = () => {\n    setShapeVisibility(!shapeVisibility);\n  }\n\n  if (canvasImage) {\n    return (\n      <div>\n        <br />\n        <div style={{ backgroundColor: \"#FFFFFF\", borderRadius: \"3px\", boxShadow: \"3px 3px 3px #b4beb7\", padding: \"50px\", maxWidth: \"800px\", height: \"auto\" }}>\n          <Caption enteredCaption={enteredCaption} />\n          <div>\n            <br />\n            <Sketch\n              setup={setup}\n              draw={draw}\n              mouseReleased={mouseReleased}\n              resetSketch={resetSketch}\n              setFiles={setFiles}\n            />\n          </div>\n          <br />\n          <Tags selectedTags={selectedTags} />\n        </div>\n        <ColorSelector selectColor={color => setColor(color)} />\n        <div className=\"save-data\">\n          <Button\n            disabled={!canvasImage || !caption || tags.length === 0}\n            className=\"save-button\"\n            palette=\"primary\"\n            onClick={postData}\n          >\n            {\" \"}\n            Save{\" \"}\n          </Button>\n          <ThemeProvider theme={theme}>\n            {progress &&\n              <CircularProgress />}\n          </ThemeProvider>\n        </div>\n\n\n        {\n          post ?\n            <div className=\"returnForm\" style={{\n              backgroundColor: \"#FFFFFF\",\n              borderRadius: \"3px\",\n              boxShadow: \"3px 3px 3px #b4beb7\",\n              padding: \"50px\",\n              maxWidth: \"800px\",\n              height: \"auto\"\n            }}>\n              < img\n                style={{\n                  display: \"block\",\n                  margin: \"0 auto\",\n                  height: \"50%\",\n                  borderRadius: \"5px\",\n                  zIndex: 1,\n                }}\n                className=\"returned-image\"\n                src={src}\n                alt=\"\"\n              />\n              {shapeVisibility &&\n                <img\n                  style={{\n                    display: \"block\",\n                    margin: \"0 auto\",\n                    height: \"50%\",\n                    borderRadius: \"5px\",\n                    zIndex: 2,\n                  }}\n                  className=\"returned-shape\"\n                  src={returnShape}\n                  alt=\"\"\n                />\n              }\n\n              <br />\n              <Button onClick={showShape}>\n                {shapeVisibility ? <VisibilityOffIcon fontsize=\"medium\" /> : <VisibilitySharpIcon fontsize=\"medium\" />}\n              </Button>\n              <br />\n              <ThemeProvider theme={theme}>\n                <Typography variant=\"h6\" color=\"primary\">\n                  <div className=\"returned-caption\">\n                    <i>\"</i>\n                    <i>\n                      {\" \"}\n                      <span>{returnCaption}</span>{\" \"}\n                    </i>\n                    <i>\"</i>\n                  </div>\n                </Typography>\n                <br />\n                <span className=\"tags-return\">\n                  <Typography color=\"primary\"> Your Tags: </Typography>\n                  {returnTags.map((item) => (\n                    <Chip className=\"chip1\" style={{ color: \"#B272CE\", backgroundColor: \"#FFFFFF\" }} avatar={\n                      <Avatar style={{ color: \"#B272CE\" }}>\n                        <div style={{ color: \"#FFFFFF\" }}>\n                          #\n                        </div>\n                      </Avatar>\n                    }\n                      key={item.id}\n                      label={item.tag}\n                      variant=\"outlined\"\n                    />\n                  ))}\n                </span>\n                <br />\n                <br />\n                <span className=\"ai_tags_return\">\n                  <Typography color=\"secondary\"> Tags from ImageNet AI: </Typography>\n                  {returnAITags.length === 0 && (\n                    <Typography variant=\"h12\" color=\"#000000\">\n                      <i>[couldn't identify any tags] </i>\n                    </Typography>\n                  )}\n\n                  {returnAITags.map((item) => (\n                    <Chip className=\"chip2\" style={{ color: \"#000000\", backgroundColor: \"#FFFFFF\" }}\n                      avatar={\n                        <Avatar style={{ background: \"#B5BCB4\" }}>\n                          <div style={{ color: \"#FFFFFF\" }}>\n                            #\n                          </div>\n                        </Avatar>\n                      }\n                      key={item.id}\n                      label={item.tag}\n                    />\n                  ))}\n\n                  <div>\n                    {returnAITags.map((aiitem) => {\n                      return (\n                        <MatchBar\n                          match={parseFloat(aiitem.confidence)}\n                          aitag={aiitem.tag}\n                        />\n                      );\n                    })}\n                  </div>\n                </span>\n                <br />\n                <Button onClick={resetCanvas}>Back to Well-Being upload</Button>\n                <br />\n              </ThemeProvider>\n            </div >\n            : null\n        }\n      </div>)\n  } else {\n    return (\n      <div>\n        <FileInput\n          selectImage={setCanvasImage}\n        // selectedImage={selectedImage}\n        />\n      </div>\n    );\n  }\n}"]},"metadata":{},"sourceType":"module"}
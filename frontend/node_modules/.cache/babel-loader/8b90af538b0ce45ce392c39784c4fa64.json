{"ast":null,"code":"import _regeneratorRuntime from\"/Users/jielianglin/Desktop/m-v2-frontend/frontend/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/jielianglin/Desktop/m-v2-frontend/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/jielianglin/Desktop/m-v2-frontend/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from'react';import axios from\"axios\";import FileInput from'../FileInput';import Tags from'./Tags';import Caption from'./Caption';import Sketch from'react-p5';import ColorSelector from'./ColorSelector';import EraserIcon from'./eraser/EraserIcon.png';import CheckMark from'./checkmark/CheckMark.png';import{Typography,Chip,Avatar}from\"@material-ui/core\";import Button from\"@material-ui/core/Button\";import VisibilitySharpIcon from'@material-ui/icons/VisibilitySharp';import VisibilityOffIcon from'@material-ui/icons/VisibilityOff';import{ThemeProvider}from\"@material-ui/styles\";import CircularProgress from\"@material-ui/core/CircularProgress\";import{createTheme}from\"@material-ui/core/styles\";import MatchBar from\"../../explore/Matchbar\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var slider;var checkButton;var clearButton;var cnv;var diameter=50;var smoothValue=0.05;var img;var pg;var x=0;var y=0;var imgWidth;var imgHeight;var theme=createTheme({palette:{primary:{main:\"#B272CE\"}}});export default function Mask(){var _React$useState=React.useState(['#B272CE']),_React$useState2=_slicedToArray(_React$useState,2),color=_React$useState2[0],setColor=_React$useState2[1];var _React$useState3=React.useState(null),_React$useState4=_slicedToArray(_React$useState3,2),canvasImage=_React$useState4[0],setCanvasImage=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),post=_React$useState6[0],setPost=_React$useState6[1];var _React$useState7=React.useState([]),_React$useState8=_slicedToArray(_React$useState7,2),tags=_React$useState8[0],setTags=_React$useState8[1];var _React$useState9=React.useState(null),_React$useState10=_slicedToArray(_React$useState9,2),src=_React$useState10[0],setSrc=_React$useState10[1];var _React$useState11=React.useState(null),_React$useState12=_slicedToArray(_React$useState11,2),caption=_React$useState12[0],setCaption=_React$useState12[1];var _React$useState13=React.useState(null),_React$useState14=_slicedToArray(_React$useState13,2),returnCaption=_React$useState14[0],setReturnCaption=_React$useState14[1];var _React$useState15=React.useState([]),_React$useState16=_slicedToArray(_React$useState15,2),returnTags=_React$useState16[0],setReturnTags=_React$useState16[1];var _React$useState17=React.useState([]),_React$useState18=_slicedToArray(_React$useState17,2),returnAITags=_React$useState18[0],setReturnAITags=_React$useState18[1];var _React$useState19=React.useState([]),_React$useState20=_slicedToArray(_React$useState19,2),returnShape=_React$useState20[0],setReturnShape=_React$useState20[1];var _React$useState21=React.useState(false),_React$useState22=_slicedToArray(_React$useState21,2),shapeVisibility=_React$useState22[0],setShapeVisibility=_React$useState22[1];var _React$useState23=React.useState(false),_React$useState24=_slicedToArray(_React$useState23,2),progress=_React$useState24[0],setProgress=_React$useState24[1];var enteredCaption=function enteredCaption(caption){setCaption(caption);};var selectedTags=function selectedTags(tags){setTags(tags);};var resetCanvas=function resetCanvas(){setCanvasImage(!canvasImage);};function setup(p5,canvasParentRef){cnv=p5.createCanvas(600,600).parent(canvasParentRef);img=p5.loadImage(canvasImage,function(img){p5.image(img,0,0);});pg=p5.createGraphics(600,600);checkButton=p5.createImg(\"\".concat(CheckMark)).style('margin: 10px; width: 50px; height: 50px');checkButton.position(100,200);checkButton.mousePressed(setFiles);clearButton=p5.createImg(\"\".concat(EraserIcon)).style('margin: 10px; width: 50px; height: 50px');clearButton.position(100,300);clearButton.mousePressed(resetSketch);slider=p5.createSlider(10,100,50,10);slider.position(1175,600);slider.style('width','80px');slider.mousePressed(getDiameter);}function getDiameter(p5){diameter=slider.value();return diameter;}var draw=function draw(p5){if(color){x=p5.lerp(p5.pmouseX,p5.mouseX,smoothValue);y=p5.lerp(p5.pmouseY,p5.mouseY,smoothValue);imgWidth=img.width;imgHeight=img.height;if(imgWidth>0&&imgHeight>0){p5.resizeCanvas(imgWidth,imgHeight);if(imgWidth>800){p5.resizeCanvas(700,imgHeight);}}p5.image(img,0,0);var transparency=p5.color(color);transparency.setAlpha(7);pg.noStroke();pg.fill(transparency);if(p5.mouseIsPressed){pg.ellipse(x,y,diameter,diameter);}p5.image(pg,0,0,imgWidth,imgHeight);}else{return null;}};function resetSketch(p5){pg.clear();}//preparing files for p5 post\nfunction setFiles(p5){var image=cnv.elt.toDataURL();var shape=pg.elt.toDataURL();return{image:image,shape:shape};}var APIurl=\"http://localhost:8000/images\";//p5 post function\n// function P5PostRequest(p5) {\n//   p5.httpPost(APIurl, 'json', P5PostData,\n//     function (result) {\n//       console.log(\"postedCanvas\")\n//     });\n// }\n// main post function\nfunction postData(_x){return _postData.apply(this,arguments);}function _postData(){_postData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(p5){var _setFiles,image,shape,formData,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_setFiles=setFiles(p5),image=_setFiles.image,shape=_setFiles.shape;formData=new FormData();console.log(tags.join(\",\"));formData.append(\"tags\",tags.join(\",\"));formData.append(\"caption\",caption);formData.append(\"files\",[image,shape]);response={};_context.prev=7;_context.next=10;return axios.post(APIurl,formData);case 10:response=_context.sent;_context.next=17;break;case 13:_context.prev=13;_context.t0=_context[\"catch\"](7);console.error(_context.t0);return _context.abrupt(\"return\");case 17:setSrc(\"http://localhost:8000/images/\".concat(response.data.id,\".jpeg\"));console.log(response.data.caption);setReturnCaption(response.data.caption);console.log(response.data.tags);setReturnTags(response.data.tags);console.log(response.data.ai_tags);setReturnAITags(response.data.ai_tags||[]);setReturnShape(\"http://localhost:8000/images/\".concat(response.data.shape,\".png\"));setPost(true);setProgress(false);case 27:case\"end\":return _context.stop();}}},_callee,null,[[7,13]]);}));return _postData.apply(this,arguments);}var showShape=function showShape(){setShapeVisibility(!shapeVisibility);};if(canvasImage){return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"div\",{style:{backgroundColor:\"#FFFFFF\",borderRadius:\"3px\",boxShadow:\"3px 3px 3px #b4beb7\",padding:\"50px\",maxWidth:\"800px\",height:\"auto\"},children:[/*#__PURE__*/_jsx(Caption,{enteredCaption:enteredCaption}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Sketch,{setup:setup,draw:draw})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Tags,{selectedTags:selectedTags})]}),/*#__PURE__*/_jsx(ColorSelector,{selectColor:function selectColor(color){return setColor(color);}}),/*#__PURE__*/_jsxs(\"div\",{className:\"save-data\",children:[/*#__PURE__*/_jsxs(Button,{disabled:!canvasImage||!caption||tags.length===0,className:\"save-button\",palette:\"primary\",onClick:postData,children:[\" \",\"Save\",\" \"]}),/*#__PURE__*/_jsx(ThemeProvider,{theme:theme,children:progress&&/*#__PURE__*/_jsx(CircularProgress,{})})]}),post?/*#__PURE__*/_jsxs(\"div\",{className:\"returnForm\",style:{backgroundColor:\"#FFFFFF\",borderRadius:\"3px\",boxShadow:\"3px 3px 3px #b4beb7\",padding:\"50px\",maxWidth:\"800px\",height:\"auto\"},children:[/*#__PURE__*/_jsx(\"img\",{style:{display:\"block\",margin:\"0 auto\",height:\"50%\",borderRadius:\"5px\",zIndex:1},className:\"returned-image\",src:src,alt:\"\"}),shapeVisibility&&/*#__PURE__*/_jsx(\"img\",{style:{display:\"block\",margin:\"0 auto\",height:\"50%\",borderRadius:\"5px\",zIndex:2},className:\"returned-shape\",src:returnShape,alt:\"\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Button,{onClick:showShape,children:shapeVisibility?/*#__PURE__*/_jsx(VisibilityOffIcon,{fontsize:\"medium\"}):/*#__PURE__*/_jsx(VisibilitySharpIcon,{fontsize:\"medium\"})}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(ThemeProvider,{theme:theme,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",color:\"primary\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"returned-caption\",children:[/*#__PURE__*/_jsx(\"i\",{children:\"\\\"\"}),/*#__PURE__*/_jsxs(\"i\",{children:[\" \",/*#__PURE__*/_jsx(\"span\",{children:returnCaption}),\" \"]}),/*#__PURE__*/_jsx(\"i\",{children:\"\\\"\"})]})}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"span\",{className:\"tags-return\",children:[/*#__PURE__*/_jsx(Typography,{color:\"primary\",children:\" Your Tags: \"}),returnTags.map(function(item){return/*#__PURE__*/_jsx(Chip,{className:\"chip1\",style:{color:\"#B272CE\",backgroundColor:\"#FFFFFF\"},avatar:/*#__PURE__*/_jsx(Avatar,{style:{color:\"#B272CE\"},children:/*#__PURE__*/_jsx(\"div\",{style:{color:\"#FFFFFF\"},children:\"#\"})}),label:item.tag,variant:\"outlined\"},item.id);})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"span\",{className:\"ai_tags_return\",children:[/*#__PURE__*/_jsx(Typography,{color:\"secondary\",children:\" Tags from ImageNet AI: \"}),returnAITags.length===0&&/*#__PURE__*/_jsx(Typography,{variant:\"h12\",color:\"#000000\",children:/*#__PURE__*/_jsx(\"i\",{children:\"[couldn't identify any tags] \"})}),/*#__PURE__*/_jsx(\"div\",{children:returnAITags.map(function(item){return/*#__PURE__*/_jsx(Chip,{className:\"chip2\",style:{color:\"#000000\",backgroundColor:\"#FFFFFF\"},avatar:/*#__PURE__*/_jsx(Avatar,{style:{background:\"#B5BCB4\"},children:/*#__PURE__*/_jsx(\"div\",{style:{color:\"#FFFFFF\"},children:\"#\"})}),label:item.tag},item.id);})}),/*#__PURE__*/_jsx(\"div\",{children:returnAITags.map(function(aiitem){return/*#__PURE__*/_jsx(MatchBar,{match:parseFloat(aiitem.confidence),aitag:aiitem.tag});})})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Button,{onClick:resetCanvas,children:\"Back to WellBeing upload\"}),/*#__PURE__*/_jsx(\"br\",{})]})]}):null]});}else{return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(FileInput,{selectImage:setCanvasImage})]});}}","map":{"version":3,"sources":["/Users/jielianglin/Desktop/m-v2-frontend/frontend/src/components/upload/annotation/P5Mask.js"],"names":["React","axios","FileInput","Tags","Caption","Sketch","ColorSelector","EraserIcon","CheckMark","Typography","Chip","Avatar","Button","VisibilitySharpIcon","VisibilityOffIcon","ThemeProvider","CircularProgress","createTheme","MatchBar","slider","checkButton","clearButton","cnv","diameter","smoothValue","img","pg","x","y","imgWidth","imgHeight","theme","palette","primary","main","Mask","useState","color","setColor","canvasImage","setCanvasImage","post","setPost","tags","setTags","src","setSrc","caption","setCaption","returnCaption","setReturnCaption","returnTags","setReturnTags","returnAITags","setReturnAITags","returnShape","setReturnShape","shapeVisibility","setShapeVisibility","progress","setProgress","enteredCaption","selectedTags","resetCanvas","setup","p5","canvasParentRef","createCanvas","parent","loadImage","image","createGraphics","createImg","style","position","mousePressed","setFiles","resetSketch","createSlider","getDiameter","value","draw","lerp","pmouseX","mouseX","pmouseY","mouseY","width","height","resizeCanvas","transparency","setAlpha","noStroke","fill","mouseIsPressed","ellipse","clear","elt","toDataURL","shape","APIurl","postData","formData","FormData","console","log","join","append","response","error","data","id","ai_tags","showShape","backgroundColor","borderRadius","boxShadow","padding","maxWidth","length","display","margin","zIndex","map","item","tag","background","aiitem","parseFloat","confidence"],"mappings":"yYAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CAEA,MAAOC,CAAAA,SAAP,KAAsB,cAAtB,CACA,MAAOC,CAAAA,IAAP,KAAiB,QAAjB,CACA,MAAOC,CAAAA,OAAP,KAAoB,WAApB,CAEA,MAAOC,CAAAA,MAAP,KAAmB,UAAnB,CACA,MAAOC,CAAAA,aAAP,KAA0B,iBAA1B,CAEA,MAAOC,CAAAA,UAAP,KAAuB,yBAAvB,CACA,MAAOC,CAAAA,SAAP,KAAsB,2BAAtB,CAEA,OAASC,UAAT,CAAqBC,IAArB,CAA2BC,MAA3B,KAAyC,mBAAzC,CACA,MAAOC,CAAAA,MAAP,KAAmB,0BAAnB,CACA,MAAOC,CAAAA,mBAAP,KAAgC,oCAAhC,CACA,MAAOC,CAAAA,iBAAP,KAA8B,kCAA9B,CAGA,OAASC,aAAT,KAA8B,qBAA9B,CACA,MAAOC,CAAAA,gBAAP,KAA6B,oCAA7B,CACA,OAASC,WAAT,KAA4B,0BAA5B,CAEA,MAAOC,CAAAA,QAAP,KAAqB,wBAArB,C,wFAEA,GAAIC,CAAAA,MAAJ,CACA,GAAIC,CAAAA,WAAJ,CACA,GAAIC,CAAAA,WAAJ,CACA,GAAIC,CAAAA,GAAJ,CAEA,GAAIC,CAAAA,QAAQ,CAAG,EAAf,CACA,GAAIC,CAAAA,WAAW,CAAG,IAAlB,CACA,GAAIC,CAAAA,GAAJ,CACA,GAAIC,CAAAA,EAAJ,CAEA,GAAIC,CAAAA,CAAC,CAAG,CAAR,CACA,GAAIC,CAAAA,CAAC,CAAG,CAAR,CACA,GAAIC,CAAAA,QAAJ,CACA,GAAIC,CAAAA,SAAJ,CAEA,GAAMC,CAAAA,KAAK,CAAGd,WAAW,CAAC,CACtBe,OAAO,CAAE,CACLC,OAAO,CAAE,CACLC,IAAI,CAAE,SADD,CADJ,CADa,CAAD,CAAzB,CAQA,cAAe,SAASC,CAAAA,IAAT,EAAgB,CAE3B,oBAA0BnC,KAAK,CAACoC,QAAN,CAAe,CAAC,SAAD,CAAf,CAA1B,oDAAOC,KAAP,qBAAcC,QAAd,qBACA,qBAAsCtC,KAAK,CAACoC,QAAN,CAAe,IAAf,CAAtC,qDAAOG,WAAP,qBAAoBC,cAApB,qBAEA,qBAAwBxC,KAAK,CAACoC,QAAN,CAAe,KAAf,CAAxB,qDAAOK,IAAP,qBAAaC,OAAb,qBACA,qBAAwB1C,KAAK,CAACoC,QAAN,CAAe,EAAf,CAAxB,qDAAOO,IAAP,qBAAaC,OAAb,qBACA,qBAAsB5C,KAAK,CAACoC,QAAN,CAAe,IAAf,CAAtB,sDAAOS,GAAP,sBAAYC,MAAZ,sBACA,sBAA8B9C,KAAK,CAACoC,QAAN,CAAe,IAAf,CAA9B,uDAAOW,OAAP,sBAAgBC,UAAhB,sBACA,sBAA0ChD,KAAK,CAACoC,QAAN,CAAe,IAAf,CAA1C,uDAAOa,aAAP,sBAAsBC,gBAAtB,sBACA,sBAAoClD,KAAK,CAACoC,QAAN,CAAe,EAAf,CAApC,uDAAOe,UAAP,sBAAmBC,aAAnB,sBACA,sBAAwCpD,KAAK,CAACoC,QAAN,CAAe,EAAf,CAAxC,uDAAOiB,YAAP,sBAAqBC,eAArB,sBACA,sBAAsCtD,KAAK,CAACoC,QAAN,CAAe,EAAf,CAAtC,uDAAOmB,WAAP,sBAAoBC,cAApB,sBACA,sBAA8CxD,KAAK,CAACoC,QAAN,CAAe,KAAf,CAA9C,uDAAOqB,eAAP,sBAAwBC,kBAAxB,sBACA,sBAAgC1D,KAAK,CAACoC,QAAN,CAAe,KAAf,CAAhC,uDAAOuB,QAAP,sBAAiBC,WAAjB,sBAEA,GAAMC,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,CAACd,OAAD,CAAa,CAChCC,UAAU,CAACD,OAAD,CAAV,CACH,CAFD,CAGA,GAAMe,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAACnB,IAAD,CAAU,CAC3BC,OAAO,CAACD,IAAD,CAAP,CACH,CAFD,CAIA,GAAMoB,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,EAAM,CACtBvB,cAAc,CAAC,CAACD,WAAF,CAAd,CACH,CAFD,CAIA,QAASyB,CAAAA,KAAT,CAAeC,EAAf,CAAmBC,eAAnB,CAAoC,CAChC5C,GAAG,CAAG2C,EAAE,CAACE,YAAH,CAAgB,GAAhB,CAAqB,GAArB,EAA0BC,MAA1B,CAAiCF,eAAjC,CAAN,CAEAzC,GAAG,CAAGwC,EAAE,CAACI,SAAH,CAAa9B,WAAb,CAA0B,SAAAd,GAAG,CAAI,CACnCwC,EAAE,CAACK,KAAH,CAAS7C,GAAT,CAAc,CAAd,CAAiB,CAAjB,EACH,CAFK,CAAN,CAIAC,EAAE,CAAGuC,EAAE,CAACM,cAAH,CAAkB,GAAlB,CAAuB,GAAvB,CAAL,CAEAnD,WAAW,CAAG6C,EAAE,CAACO,SAAH,WAAgBhE,SAAhB,GAA6BiE,KAA7B,CACV,yCADU,CAAd,CAIArD,WAAW,CAACsD,QAAZ,CAAqB,GAArB,CAA0B,GAA1B,EACAtD,WAAW,CAACuD,YAAZ,CAAyBC,QAAzB,EAEAvD,WAAW,CAAG4C,EAAE,CAACO,SAAH,WAAgBjE,UAAhB,GAA8BkE,KAA9B,CACV,yCADU,CAAd,CAGApD,WAAW,CAACqD,QAAZ,CAAqB,GAArB,CAA0B,GAA1B,EACArD,WAAW,CAACsD,YAAZ,CAAyBE,WAAzB,EAEA1D,MAAM,CAAG8C,EAAE,CAACa,YAAH,CAAgB,EAAhB,CAAoB,GAApB,CAAyB,EAAzB,CAA6B,EAA7B,CAAT,CACA3D,MAAM,CAACuD,QAAP,CAAgB,IAAhB,CAAsB,GAAtB,EACAvD,MAAM,CAACsD,KAAP,CAAa,OAAb,CAAsB,MAAtB,EACAtD,MAAM,CAACwD,YAAP,CAAoBI,WAApB,EACH,CAED,QAASA,CAAAA,WAAT,CAAqBd,EAArB,CAAyB,CACrB1C,QAAQ,CAAGJ,MAAM,CAAC6D,KAAP,EAAX,CACA,MAAQzD,CAAAA,QAAR,CACH,CAED,GAAM0D,CAAAA,IAAI,CAAG,QAAPA,CAAAA,IAAO,CAAAhB,EAAE,CAAI,CACf,GAAI5B,KAAJ,CAAW,CACPV,CAAC,CAAGsC,EAAE,CAACiB,IAAH,CAAQjB,EAAE,CAACkB,OAAX,CAAoBlB,EAAE,CAACmB,MAAvB,CAA+B5D,WAA/B,CAAJ,CACAI,CAAC,CAAGqC,EAAE,CAACiB,IAAH,CAAQjB,EAAE,CAACoB,OAAX,CAAoBpB,EAAE,CAACqB,MAAvB,CAA+B9D,WAA/B,CAAJ,CAGAK,QAAQ,CAAGJ,GAAG,CAAC8D,KAAf,CACAzD,SAAS,CAAGL,GAAG,CAAC+D,MAAhB,CAEA,GAAI3D,QAAQ,CAAG,CAAX,EAAgBC,SAAS,CAAG,CAAhC,CAAmC,CAC/BmC,EAAE,CAACwB,YAAH,CAAgB5D,QAAhB,CAA0BC,SAA1B,EACA,GAAID,QAAQ,CAAG,GAAf,CAAoB,CAChBoC,EAAE,CAACwB,YAAH,CAAgB,GAAhB,CAAqB3D,SAArB,EACH,CACJ,CAEDmC,EAAE,CAACK,KAAH,CAAS7C,GAAT,CAAc,CAAd,CAAiB,CAAjB,EAEA,GAAIiE,CAAAA,YAAY,CAAGzB,EAAE,CAAC5B,KAAH,CAASA,KAAT,CAAnB,CACAqD,YAAY,CAACC,QAAb,CAAsB,CAAtB,EACAjE,EAAE,CAACkE,QAAH,GACAlE,EAAE,CAACmE,IAAH,CAAQH,YAAR,EAEA,GAAIzB,EAAE,CAAC6B,cAAP,CAAuB,CACnBpE,EAAE,CAACqE,OAAH,CAAWpE,CAAX,CAAcC,CAAd,CAAiBL,QAAjB,CAA2BA,QAA3B,EACH,CAED0C,EAAE,CAACK,KAAH,CAAS5C,EAAT,CAAa,CAAb,CAAgB,CAAhB,CAAmBG,QAAnB,CAA6BC,SAA7B,EACH,CA3BD,IA2BO,CACH,MAAO,KAAP,CACH,CACJ,CA/BD,CAiCA,QAAS+C,CAAAA,WAAT,CAAqBZ,EAArB,CAAyB,CACrBvC,EAAE,CAACsE,KAAH,GACH,CAED;AACA,QAASpB,CAAAA,QAAT,CAAkBX,EAAlB,CAAsB,CAClB,GAAIK,CAAAA,KAAK,CAAGhD,GAAG,CAAC2E,GAAJ,CAAQC,SAAR,EAAZ,CACA,GAAIC,CAAAA,KAAK,CAAGzE,EAAE,CAACuE,GAAH,CAAOC,SAAP,EAAZ,CACA,MAAO,CAAE5B,KAAK,CAALA,KAAF,CAAS6B,KAAK,CAALA,KAAT,CAAP,CACH,CAED,GAAIC,CAAAA,MAAM,CAAG,8BAAb,CAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAlH2B,QAmHZC,CAAAA,QAnHY,oIAmH3B,iBAAwBpC,EAAxB,wKAC2BW,QAAQ,CAACX,EAAD,CADnC,CACUK,KADV,WACUA,KADV,CACiB6B,KADjB,WACiBA,KADjB,CAGQG,QAHR,CAGmB,GAAIC,CAAAA,QAAJ,EAHnB,CAIIC,OAAO,CAACC,GAAR,CAAY9D,IAAI,CAAC+D,IAAL,CAAU,GAAV,CAAZ,EACAJ,QAAQ,CAACK,MAAT,CAAgB,MAAhB,CAAwBhE,IAAI,CAAC+D,IAAL,CAAU,GAAV,CAAxB,EACAJ,QAAQ,CAACK,MAAT,CAAgB,SAAhB,CAA2B5D,OAA3B,EACAuD,QAAQ,CAACK,MAAT,CAAgB,OAAhB,CAAyB,CAACrC,KAAD,CAAQ6B,KAAR,CAAzB,EAEIS,QATR,CASmB,EATnB,wCAWyB3G,CAAAA,KAAK,CAACwC,IAAN,CAAW2D,MAAX,CAAmBE,QAAnB,CAXzB,SAWQM,QAXR,gGAaQJ,OAAO,CAACK,KAAR,cAbR,yCAiBI/D,MAAM,wCAAiC8D,QAAQ,CAACE,IAAT,CAAcC,EAA/C,UAAN,CACAP,OAAO,CAACC,GAAR,CAAYG,QAAQ,CAACE,IAAT,CAAc/D,OAA1B,EACAG,gBAAgB,CAAC0D,QAAQ,CAACE,IAAT,CAAc/D,OAAf,CAAhB,CACAyD,OAAO,CAACC,GAAR,CAAYG,QAAQ,CAACE,IAAT,CAAcnE,IAA1B,EACAS,aAAa,CAACwD,QAAQ,CAACE,IAAT,CAAcnE,IAAf,CAAb,CACA6D,OAAO,CAACC,GAAR,CAAYG,QAAQ,CAACE,IAAT,CAAcE,OAA1B,EACA1D,eAAe,CAACsD,QAAQ,CAACE,IAAT,CAAcE,OAAd,EAAyB,EAA1B,CAAf,CACAxD,cAAc,wCAAiCoD,QAAQ,CAACE,IAAT,CAAcX,KAA/C,SAAd,CACAzD,OAAO,CAAC,IAAD,CAAP,CACAkB,WAAW,CAAC,KAAD,CAAX,CA1BJ,qEAnH2B,2CAgJ3B,GAAMqD,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,EAAM,CACpBvD,kBAAkB,CAAC,CAACD,eAAF,CAAlB,CACH,CAFD,CAIA,GAAIlB,WAAJ,CAAiB,CACb,mBACI,oCACI,aADJ,cAEI,aAAK,KAAK,CAAE,CAAE2E,eAAe,CAAE,SAAnB,CAA8BC,YAAY,CAAE,KAA5C,CAAmDC,SAAS,CAAE,qBAA9D,CAAqFC,OAAO,CAAE,MAA9F,CAAsGC,QAAQ,CAAE,OAAhH,CAAyH9B,MAAM,CAAE,MAAjI,CAAZ,wBACI,KAAC,OAAD,EAAS,cAAc,CAAE3B,cAAzB,EADJ,cAEI,oCACI,aADJ,cAEI,KAAC,MAAD,EAAQ,KAAK,CAAEG,KAAf,CAAsB,IAAI,CAAEiB,IAA5B,EAFJ,GAFJ,cAOI,aAPJ,cAQI,KAAC,IAAD,EAAM,YAAY,CAAEnB,YAApB,EARJ,GAFJ,cAYI,KAAC,aAAD,EAAe,WAAW,CAAE,qBAAAzB,KAAK,QAAIC,CAAAA,QAAQ,CAACD,KAAD,CAAZ,EAAjC,EAZJ,cAaI,aAAK,SAAS,CAAC,WAAf,wBACI,MAAC,MAAD,EACI,QAAQ,CAAE,CAACE,WAAD,EAAgB,CAACQ,OAAjB,EAA4BJ,IAAI,CAAC4E,MAAL,GAAgB,CAD1D,CAEI,SAAS,CAAC,aAFd,CAGI,OAAO,CAAC,SAHZ,CAII,OAAO,CAAElB,QAJb,WAMK,GANL,QAOS,GAPT,GADJ,cAUI,KAAC,aAAD,EAAe,KAAK,CAAEtE,KAAtB,UACK4B,QAAQ,eACL,KAAC,gBAAD,IAFR,EAVJ,GAbJ,CA6BQlB,IAAI,cACA,aAAK,SAAS,CAAC,YAAf,CAA4B,KAAK,CAAE,CAAEyE,eAAe,CAAE,SAAnB,CAA8BC,YAAY,CAAE,KAA5C,CAAmDC,SAAS,CAAE,qBAA9D,CAAqFC,OAAO,CAAE,MAA9F,CAAsGC,QAAQ,CAAE,OAAhH,CAAyH9B,MAAM,CAAE,MAAjI,CAAnC,wBACI,YACI,KAAK,CAAE,CACHgC,OAAO,CAAE,OADN,CAEHC,MAAM,CAAE,QAFL,CAGHjC,MAAM,CAAE,KAHL,CAIH2B,YAAY,CAAE,KAJX,CAKHO,MAAM,CAAE,CALL,CADX,CAQI,SAAS,CAAC,gBARd,CASI,GAAG,CAAE7E,GATT,CAUI,GAAG,CAAC,EAVR,EADJ,CAaKY,eAAe,eACZ,YACI,KAAK,CAAE,CACH+D,OAAO,CAAE,OADN,CAEHC,MAAM,CAAE,QAFL,CAGHjC,MAAM,CAAE,KAHL,CAIH2B,YAAY,CAAE,KAJX,CAKHO,MAAM,CAAE,CALL,CADX,CAQI,SAAS,CAAC,gBARd,CASI,GAAG,CAAEnE,WATT,CAUI,GAAG,CAAC,EAVR,EAdR,cA4BI,aA5BJ,cA6BI,KAAC,MAAD,EAAQ,OAAO,CAAE0D,SAAjB,UACKxD,eAAe,cAAG,KAAC,iBAAD,EAAmB,QAAQ,CAAC,QAA5B,EAAH,cAA6C,KAAC,mBAAD,EAAqB,QAAQ,CAAC,QAA9B,EADjE,EA7BJ,cAgCI,aAhCJ,cAiCI,MAAC,aAAD,EAAe,KAAK,CAAE1B,KAAtB,wBACI,KAAC,UAAD,EAAY,OAAO,CAAC,IAApB,CAAyB,KAAK,CAAC,SAA/B,uBACI,aAAK,SAAS,CAAC,kBAAf,wBACI,yBADJ,cAEI,qBACK,GADL,cAEI,sBAAOkB,aAAP,EAFJ,CAEiC,GAFjC,GAFJ,cAMI,yBANJ,GADJ,EADJ,cAWI,aAXJ,cAYI,cAAM,SAAS,CAAC,aAAhB,wBACI,KAAC,UAAD,EAAY,KAAK,CAAC,SAAlB,0BADJ,CAEKE,UAAU,CAACwE,GAAX,CAAe,SAACC,IAAD,qBACZ,KAAC,IAAD,EAAM,SAAS,CAAC,OAAhB,CAAwB,KAAK,CAAE,CAAEvF,KAAK,CAAE,SAAT,CAAoB6E,eAAe,CAAE,SAArC,CAA/B,CAAiF,MAAM,cACnF,KAAC,MAAD,EAAQ,KAAK,CAAE,CAAE7E,KAAK,CAAE,SAAT,CAAf,uBACI,YAAK,KAAK,CAAE,CAAEA,KAAK,CAAE,SAAT,CAAZ,eADJ,EADJ,CAQI,KAAK,CAAEuF,IAAI,CAACC,GARhB,CASI,OAAO,CAAC,UATZ,EAOSD,IAAI,CAACb,EAPd,CADY,EAAf,CAFL,GAZJ,cA4BI,aA5BJ,cA6BI,aA7BJ,cA8BI,cAAM,SAAS,CAAC,gBAAhB,wBACI,KAAC,UAAD,EAAY,KAAK,CAAC,WAAlB,sCADJ,CAEK1D,YAAY,CAACkE,MAAb,GAAwB,CAAxB,eACG,KAAC,UAAD,EAAY,OAAO,CAAC,KAApB,CAA0B,KAAK,CAAC,SAAhC,uBACI,oDADJ,EAHR,cAOI,qBACKlE,YAAY,CAACsE,GAAb,CAAiB,SAACC,IAAD,qBACd,KAAC,IAAD,EAAM,SAAS,CAAC,OAAhB,CAAwB,KAAK,CAAE,CAAEvF,KAAK,CAAE,SAAT,CAAoB6E,eAAe,CAAE,SAArC,CAA/B,CACI,MAAM,cACF,KAAC,MAAD,EAAQ,KAAK,CAAE,CAAEY,UAAU,CAAE,SAAd,CAAf,uBACI,YAAK,KAAK,CAAE,CAAEzF,KAAK,CAAE,SAAT,CAAZ,eADJ,EAFR,CASI,KAAK,CAAEuF,IAAI,CAACC,GAThB,EAQSD,IAAI,CAACb,EARd,CADc,EAAjB,CADL,EAPJ,cAsBI,qBACK1D,YAAY,CAACsE,GAAb,CAAiB,SAACI,MAAD,CAAY,CAC1B,mBACI,KAAC,QAAD,EACI,KAAK,CAAEC,UAAU,CAACD,MAAM,CAACE,UAAR,CADrB,CAEI,KAAK,CAAEF,MAAM,CAACF,GAFlB,EADJ,CAMH,CAPA,CADL,EAtBJ,GA9BJ,cA+DI,aA/DJ,cAgEI,KAAC,MAAD,EAAQ,OAAO,CAAE9D,WAAjB,sCAhEJ,cAiEI,aAjEJ,GAjCJ,GADA,CAsGE,IAnId,GADJ,CAuIH,CAxID,IAwIO,CACH,mBACI,oCACI,aADJ,cAEI,KAAC,SAAD,EAAW,WAAW,CAAEvB,cAAxB,EAFJ,GADJ,CAMH,CACJ","sourcesContent":["import React from 'react';\nimport axios from \"axios\";\n\nimport FileInput from '../FileInput';\nimport Tags from './Tags';\nimport Caption from './Caption';\n\nimport Sketch from 'react-p5';\nimport ColorSelector from './ColorSelector';\n\nimport EraserIcon from './eraser/EraserIcon.png';\nimport CheckMark from './checkmark/CheckMark.png';\n\nimport { Typography, Chip, Avatar } from \"@material-ui/core\";\nimport Button from \"@material-ui/core/Button\";\nimport VisibilitySharpIcon from '@material-ui/icons/VisibilitySharp';\nimport VisibilityOffIcon from '@material-ui/icons/VisibilityOff';\n\n\nimport { ThemeProvider } from \"@material-ui/styles\";\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\nimport { createTheme } from \"@material-ui/core/styles\";\n\nimport MatchBar from \"../../explore/Matchbar\";\n\nvar slider;\nvar checkButton;\nvar clearButton;\nvar cnv;\n\nvar diameter = 50;\nvar smoothValue = 0.05;\nlet img;\nlet pg;\n\nvar x = 0;\nvar y = 0;\nvar imgWidth;\nvar imgHeight;\n\nconst theme = createTheme({\n    palette: {\n        primary: {\n            main: \"#B272CE\",\n        },\n    },\n});\n\nexport default function Mask() {\n\n    const [color, setColor] = React.useState(['#B272CE']);\n    const [canvasImage, setCanvasImage] = React.useState(null);\n\n    const [post, setPost] = React.useState(false);\n    const [tags, setTags] = React.useState([]);\n    const [src, setSrc] = React.useState(null);\n    const [caption, setCaption] = React.useState(null);\n    const [returnCaption, setReturnCaption] = React.useState(null);\n    const [returnTags, setReturnTags] = React.useState([])\n    const [returnAITags, setReturnAITags] = React.useState([]);\n    const [returnShape, setReturnShape] = React.useState([]);\n    const [shapeVisibility, setShapeVisibility] = React.useState(false);\n    const [progress, setProgress] = React.useState(false);\n\n    const enteredCaption = (caption) => {\n        setCaption(caption);\n    };\n    const selectedTags = (tags) => {\n        setTags(tags);\n    };\n\n    const resetCanvas = () => {\n        setCanvasImage(!canvasImage);\n    }\n\n    function setup(p5, canvasParentRef) {\n        cnv = p5.createCanvas(600, 600).parent(canvasParentRef);\n\n        img = p5.loadImage(canvasImage, img => {\n            p5.image(img, 0, 0);\n        });\n\n        pg = p5.createGraphics(600, 600);\n\n        checkButton = p5.createImg(`${CheckMark}`).style(\n            'margin: 10px; width: 50px; height: 50px'\n        )\n\n        checkButton.position(100, 200);\n        checkButton.mousePressed(setFiles);\n\n        clearButton = p5.createImg(`${EraserIcon}`).style(\n            'margin: 10px; width: 50px; height: 50px'\n        )\n        clearButton.position(100, 300);\n        clearButton.mousePressed(resetSketch);\n\n        slider = p5.createSlider(10, 100, 50, 10);\n        slider.position(1175, 600);\n        slider.style('width', '80px');\n        slider.mousePressed(getDiameter);\n    }\n\n    function getDiameter(p5) {\n        diameter = slider.value();\n        return (diameter);\n    }\n\n    const draw = p5 => {\n        if (color) {\n            x = p5.lerp(p5.pmouseX, p5.mouseX, smoothValue);\n            y = p5.lerp(p5.pmouseY, p5.mouseY, smoothValue);\n\n\n            imgWidth = img.width;\n            imgHeight = img.height;\n\n            if (imgWidth > 0 && imgHeight > 0) {\n                p5.resizeCanvas(imgWidth, imgHeight);\n                if (imgWidth > 800) {\n                    p5.resizeCanvas(700, imgHeight);\n                }\n            }\n\n            p5.image(img, 0, 0);\n\n            var transparency = p5.color(color);\n            transparency.setAlpha(7);\n            pg.noStroke();\n            pg.fill(transparency);\n\n            if (p5.mouseIsPressed) {\n                pg.ellipse(x, y, diameter, diameter);\n            }\n\n            p5.image(pg, 0, 0, imgWidth, imgHeight);\n        } else {\n            return null\n        }\n    }\n\n    function resetSketch(p5) {\n        pg.clear();\n    }\n\n    //preparing files for p5 post\n    function setFiles(p5) {\n        let image = cnv.elt.toDataURL();\n        let shape = pg.elt.toDataURL();\n        return { image, shape };\n    }\n\n    let APIurl = \"http://localhost:8000/images\";\n\n    //p5 post function\n    // function P5PostRequest(p5) {\n    //   p5.httpPost(APIurl, 'json', P5PostData,\n    //     function (result) {\n    //       console.log(\"postedCanvas\")\n    //     });\n    // }\n\n    // main post function\n    async function postData(p5) {\n        let { image, shape } = setFiles(p5);\n\n        let formData = new FormData();\n        console.log(tags.join(\",\"));\n        formData.append(\"tags\", tags.join(\",\"));\n        formData.append(\"caption\", caption);\n        formData.append(\"files\", [image, shape]);\n\n        let response = {};\n        try {\n            response = await axios.post(APIurl, formData);\n        } catch (e) {\n            console.error(e);\n            return;\n        }\n\n        setSrc(`http://localhost:8000/images/${response.data.id}.jpeg`);\n        console.log(response.data.caption);\n        setReturnCaption(response.data.caption);\n        console.log(response.data.tags);\n        setReturnTags(response.data.tags);\n        console.log(response.data.ai_tags);\n        setReturnAITags(response.data.ai_tags || []);\n        setReturnShape(`http://localhost:8000/images/${response.data.shape}.png`);\n        setPost(true);\n        setProgress(false);\n    }\n\n    const showShape = () => {\n        setShapeVisibility(!shapeVisibility);\n    }\n\n    if (canvasImage) {\n        return (\n            <div>\n                <br />\n                <div style={{ backgroundColor: \"#FFFFFF\", borderRadius: \"3px\", boxShadow: \"3px 3px 3px #b4beb7\", padding: \"50px\", maxWidth: \"800px\", height: \"auto\" }}>\n                    <Caption enteredCaption={enteredCaption} />\n                    <div>\n                        <br />\n                        <Sketch setup={setup} draw={draw}\n                        />\n                    </div>\n                    <br />\n                    <Tags selectedTags={selectedTags} />\n                </div>\n                <ColorSelector selectColor={color => setColor(color)} />\n                <div className=\"save-data\">\n                    <Button\n                        disabled={!canvasImage || !caption || tags.length === 0}\n                        className=\"save-button\"\n                        palette=\"primary\"\n                        onClick={postData}\n                    >\n                        {\" \"}\n                        Save{\" \"}\n                    </Button>\n                    <ThemeProvider theme={theme}>\n                        {progress &&\n                            <CircularProgress />}\n                    </ThemeProvider>\n                </div>\n                {\n                    post ?\n                        <div className=\"returnForm\" style={{ backgroundColor: \"#FFFFFF\", borderRadius: \"3px\", boxShadow: \"3px 3px 3px #b4beb7\", padding: \"50px\", maxWidth: \"800px\", height: \"auto\" }}>\n                            < img\n                                style={{\n                                    display: \"block\",\n                                    margin: \"0 auto\",\n                                    height: \"50%\",\n                                    borderRadius: \"5px\",\n                                    zIndex: 1,\n                                }}\n                                className=\"returned-image\"\n                                src={src}\n                                alt=\"\"\n                            />\n                            {shapeVisibility &&\n                                <img\n                                    style={{\n                                        display: \"block\",\n                                        margin: \"0 auto\",\n                                        height: \"50%\",\n                                        borderRadius: \"5px\",\n                                        zIndex: 2,\n                                    }}\n                                    className=\"returned-shape\"\n                                    src={returnShape}\n                                    alt=\"\"\n                                />\n                            }\n\n                            <br />\n                            <Button onClick={showShape}>\n                                {shapeVisibility ? <VisibilityOffIcon fontsize=\"medium\" /> : <VisibilitySharpIcon fontsize=\"medium\" />}\n                            </Button>\n                            <br />\n                            <ThemeProvider theme={theme}>\n                                <Typography variant=\"h6\" color=\"primary\">\n                                    <div className=\"returned-caption\">\n                                        <i>\"</i>\n                                        <i>\n                                            {\" \"}\n                                            <span>{returnCaption}</span>{\" \"}\n                                        </i>\n                                        <i>\"</i>\n                                    </div>\n                                </Typography>\n                                <br />\n                                <span className=\"tags-return\">\n                                    <Typography color=\"primary\"> Your Tags: </Typography>\n                                    {returnTags.map((item) => (\n                                        <Chip className=\"chip1\" style={{ color: \"#B272CE\", backgroundColor: \"#FFFFFF\" }} avatar={\n                                            <Avatar style={{ color: \"#B272CE\" }}>\n                                                <div style={{ color: \"#FFFFFF\" }}>\n                                                    #\n                                                </div>\n                                            </Avatar>\n                                        }\n                                            key={item.id}\n                                            label={item.tag}\n                                            variant=\"outlined\"\n                                        />\n                                    ))}\n                                </span>\n                                <br />\n                                <br />\n                                <span className=\"ai_tags_return\">\n                                    <Typography color=\"secondary\"> Tags from ImageNet AI: </Typography>\n                                    {returnAITags.length === 0 && (\n                                        <Typography variant=\"h12\" color=\"#000000\">\n                                            <i>[couldn't identify any tags] </i>\n                                        </Typography>\n                                    )}\n                                    <div>\n                                        {returnAITags.map((item) => (\n                                            <Chip className=\"chip2\" style={{ color: \"#000000\", backgroundColor: \"#FFFFFF\" }}\n                                                avatar={\n                                                    <Avatar style={{ background: \"#B5BCB4\" }}>\n                                                        <div style={{ color: \"#FFFFFF\" }}>\n                                                            #\n                                                        </div>\n                                                    </Avatar>\n                                                }\n                                                key={item.id}\n                                                label={item.tag}\n                                            />\n                                        ))}\n                                    </div>\n                                    <div>\n                                        {returnAITags.map((aiitem) => {\n                                            return (\n                                                <MatchBar\n                                                    match={parseFloat(aiitem.confidence)}\n                                                    aitag={aiitem.tag}\n                                                />\n                                            );\n                                        })}\n                                    </div>\n                                </span>\n                                <br />\n                                <Button onClick={resetCanvas}>Back to WellBeing upload</Button>\n                                <br />\n                            </ThemeProvider>\n                        </div >\n                        : null\n                }\n            </div>)\n    } else {\n        return (\n            <div >\n                <br />\n                <FileInput selectImage={setCanvasImage} />\n            </div>\n        );\n    }\n}\n"]},"metadata":{},"sourceType":"module"}